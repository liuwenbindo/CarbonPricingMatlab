% adtest.m, Wenbin Liu, Sep'17
% This file is to compare the time difference of gradient calculation
% between AD and FD on the original optimal point.

startup
n = 63; %number if independent variables of input

myfun = ADfun('utilitycalc',1); %generate ADfun object with the function to be differentiated

m = [0.833862047445461,0.986771045676486,0.844791260010868,1.29452599908852,1.02337420555469,1.03977841748325,0.909265854132061,1.10715414356476,1.07129074654436,1.17879428820710,1.13498630255108,1.20495671381198,1.16330210508919,1.21134083349312,0.916642214563293,1.02588970956374,0.989552264507359,1.02911933651639,0.989687505001852,1.03469878152561,0.997319316611813,1.05050804431090,1.01424299007943,1.03965571749010,1.00313901814010,1.05301959072335,1.01704250703788,1.05809806181616,1.02357814798761,1.31483120932804,1.21111505264918,0.942347056540385,0.925019050140336,0.961782971634532,0.936607318620047,0.960033586814537,0.934807022529764,0.978733617472501,0.955852102428261,0.955911613784748,0.931118738562057,0.970787405473375,0.953775060432683,0.964705605637203,0.945202246004638,0.983836579961716,0.884296826991382,0.955166235803206,0.930175146511089,0.969332029953984,0.950727782794455,0.962403694081432,0.944746749603768,0.981491927667051,0.885571625124068,0.962295388844616,0.941208364100859,0.977588116331144,0.834170222295060,1.00049399187436,0.976793770877953,1.08893287175070,0.141227280443693];
m2 = [0.837707337037397, 0.962670980519905, 0.857812056769632, 1.16032608437118, 1.00989269507944, 1.03677010033358, 0.916194787658205, 1.17427947186098, 1.12081249514449, 1.17175557749961, 1.08356370159308, 1.18730629008919, 1.10247541463792, 1.14366519777209, 0.930023557293070, 1.03715528279697, 1.00932778127668, 1.06189648578424, 1.02278827478157, 1.07104554250665, 1.03360677302646, 1.11911500989810, 1.06623438080235, 1.07233174995470, 1.03558589840186, 1.11776197191961, 1.06573767900644, 1.12527238808855, 1.07540819620467, 1.27902519386631, 1.16089722136301, 0.925011503678447, 0.916228232471721, 0.941672473207788, 0.912313498054889, 0.945200019219748, 0.917369770069935, 0.954015959716687, 0.913697750029668, 0.944826356820969, 0.918328663121830, 0.953329719425072, 0.914748913583565, 0.962029876117074, 0.925567130553018, 0.975580261044293, 0.911582278151308, 0.944554111296555, 0.918414038042587, 0.952900062022150, 0.914811532428870, 0.961304316460740, 0.925032567419308, 0.974494631163093, 0.911150060478386, 0.961255861410721, 0.925457624550131, 0.973228300173694, 0.909020413515041, 1.00009645650893, 0.940726379085871, 1.06732796466163, 0.141073862057497];
m0 = 0.8 * m;
t1 = 0.5*ones(1,63);
z = zeros(1, 63);
t2 = 0.2 * ones(1,63);
t3 = 0.1 * ones(1,63);
t4 = 0.8 * ones(1,63);
t5 = 0.1 * ones(1,63);
t6 = 5 * ones(1,63);

for i = 1:63
   if mod(i, 2) == 0
    t2(i) = t2(i) + 0.1;
    t3(i) = t3(i) + 0.8;
    t4(i) = t4(i) + 0.1;
   end
end

for i = 2:63
    t5(i) = t5(i-1) + 0.05;
    t6(i) = t6(i-1) - 0.05;
end

T = [m;m0;t1;z;t2;t3;t4;t5;t6];
G1 = cons(zeros(size(T)),T);
G2 = cons(zeros(size(T)),T);
time1 = zeros(1,9);
time2 = zeros(1,9);

for j = 1:9
    tic
    t = T(j,:);
    [f, G1(j,:)] = feval(myfun, t); %calculate function value and gradient
    time1(j) = toc;
    
    tic
    G2(j,:) = num_grad(@utilitycalc, t);
    time2(j) = toc;
end